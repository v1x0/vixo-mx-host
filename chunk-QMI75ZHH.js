var S=Object.defineProperty,j=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var h=(e,t,o)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,i=(e,t)=>{for(var o in t||={})O.call(t,o)&&h(e,o,t[o]);if(w)for(var o of w(t))P.call(t,o)&&h(e,o,t[o]);return e},f=(e,t)=>j(e,v(t));var y="__NATIVE_FEDERATION__",N=globalThis;N[y]??={externals:new Map,remoteNamesToRemote:new Map,baseUrlToRemoteNames:new Map};var l=N[y],R=l.externals;function I(e){return`${e.packageName}@${e.version}`}function _(e){let t=I(e);return R.get(t)}function b(e,t){let o=I(e);R.set(o,t)}function M(e,t){return{imports:i(i({},e.imports),t.imports),scopes:i(i({},e.scopes),t.scopes)}}var x=l.remoteNamesToRemote,p=l.baseUrlToRemoteNames;function A(e,t){x.set(e,t),p.set(t.baseUrl,e)}function D(e){return p.get(e)}function L(e){return p.has(e)}function U(e){return x.get(e)}function T(e){document.head.appendChild(Object.assign(document.createElement("script"),{type:"importmap-shim",innerHTML:JSON.stringify(e)}))}function d(e){let t=e.split("/");return t.pop(),t.join("/")}function u(e,t){for(;e.endsWith("/");)e=e.substring(0,e.length-1);return t.startsWith("./")&&(t=t.substring(2,t.length)),`${e}/${t}`}var F=(function(e){return e.COMPLETED="federation-rebuild-complete",e.ERROR="federation-rebuild-error",e.CANCELLED="federation-rebuild-cancelled",e})(F||{});function z(e){let t=new EventSource(e);t.onmessage=function(o){JSON.parse(o.data).type===F.COMPLETED&&(console.log("[Federation] Rebuild completed, reloading..."),window.location.reload())},t.onerror=function(o){console.warn("[Federation] SSE connection error:",o)}}async function te(e={},t){let o=t?.cacheTag?`?t=${t.cacheTag}`:"",n=typeof e=="string"?await K(e+o):e,r=await $(`./remoteEntry.json${o}`),s=await G(r),a=await H(n,i({throwIfRemoteNotFound:!1},t)),c=M(s,a);return T(c),c}async function K(e){return await fetch(e).then(o=>o.json())}function W(e,t){if(!t)return e;let o=e.includes("?")?"&":"?";return`${e}${o}t=${t}`}function B(e,t,o,n){let r=`Error loading remote entry for ${e} from file ${t}`;if(o.throwIfRemoteNotFound)throw new Error(r);return console.error(r),console.error(n),null}async function H(e,t={throwIfRemoteNotFound:!1}){let o=Object.entries(e).map(async([s,a])=>{try{let c=W(a,t.cacheTag);return await k(c,s)}catch(c){return B(s,a,t,c)}});return(await Promise.all(o)).reduce((s,a)=>a?M(s,a):s,{imports:{},scopes:{}})}async function k(e,t){let o=d(e),n=await $(e);t||(t=n.name),n.buildNotificationsEndpoint&&z(o+n.buildNotificationsEndpoint);let r=J(n,t,o);return A(t,f(i({},n),{baseUrl:o})),r}function J(e,t,o){let n=q(e,t,o),r=V(e,o);return{imports:n,scopes:r}}async function $(e){return await fetch(e).then(o=>o.json())}function V(e,t){let o={},n={};for(let r of e.shared){let s=_(r)??u(t,r.outFileName);b(r,s),n[r.packageName]=s}return o[t+"/"]=n,o}function q(e,t,o){let n={};for(let r of e.exposes){let s=u(t,r.key),a=u(o,r.outFileName);n[s]=a}return n}async function G(e,t="./"){let o=e.shared.reduce((n,r)=>f(i({},n),{[r.packageName]:t+r.outFileName}),{});for(let n of e.shared)b(n,t+n.outFileName);return{imports:o,scopes:{}}}async function oe(e,t){let o=Z(e,t);await Y(o);let n=X(o),r=U(n),s=o.fallback,a=r?"":"unknown remote "+n;if(!r&&!s)throw new Error(a);if(!r)return E(a),Promise.resolve(s);let c=r.exposes.find(m=>m.key===o.exposedModule),g=c?"":`Unknown exposed module ${o.exposedModule} in remote ${n}`;if(!c&&!s)throw new Error(g);if(!c)return E(g),Promise.resolve(s);let C=u(r.baseUrl,c.outFileName);try{return Q(C)}catch(m){if(s)return console.error("error loading remote module",m),s;throw m}}function Q(e){return typeof importShim<"u"?importShim(e):import(e)}function X(e){let t;if(e.remoteName)t=e.remoteName;else if(e.remoteEntry){let o=d(e.remoteEntry);t=D(o)}else throw new Error("unexpected arguments: Please pass remoteName or remoteEntry");if(!t)throw new Error("unknown remoteName "+t);return t}async function Y(e){if(e.remoteEntry&&!L(d(e.remoteEntry))){let t=await k(e.remoteEntry);T(t)}}function Z(e,t){let o;if(typeof e=="string"&&t)o={remoteName:e,exposedModule:t};else if(typeof e=="object"&&!t)o=e;else throw new Error("unexpected arguments: please pass options or a remoteName/exposedModule-pair");return o}function E(e){typeof window<"u"&&console.error(e)}export{te as a,oe as b};
